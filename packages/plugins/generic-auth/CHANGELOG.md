# @envelop/generic-auth

## 6.0.1

### Patch Changes

- Updated dependencies []:
  - @envelop/core@4.0.1
- Updated dependencies []:
  - @envelop/extended-validation@3.0.1

## 6.0.0

### Major Changes

- [#1776](https://github.com/n1ru4l/envelop/pull/1776)
  [`332f1f22`](https://github.com/n1ru4l/envelop/commit/332f1f221f655421a850adb834afe549d50b4fac)
  Thanks [@ardatan](https://github.com/ardatan)! - Drop Node 14 and require Node 16 or higher

- Updated dependencies
  [[`332f1f22`](https://github.com/n1ru4l/envelop/commit/332f1f221f655421a850adb834afe549d50b4fac),
  [`a36925c7`](https://github.com/n1ru4l/envelop/commit/a36925c7df0538f88b51682e4e23f4b16f6fae2b)]:
  - @envelop/core@4.0.0

### Patch Changes

- [#1755](https://github.com/n1ru4l/envelop/pull/1755)
  [`17afb252`](https://github.com/n1ru4l/envelop/commit/17afb2521294ea60213c6aed0d8095ae50112842)
  Thanks [@EmrysMyrddin](https://github.com/EmrysMyrddin)! - Fix documentation to remove references
  to async `validateUser` and throwing to report errors

- Updated dependencies
  [[`332f1f22`](https://github.com/n1ru4l/envelop/commit/332f1f221f655421a850adb834afe549d50b4fac),
  [`332f1f22`](https://github.com/n1ru4l/envelop/commit/332f1f221f655421a850adb834afe549d50b4fac)]:
  - @envelop/extended-validation@3.0.0

## 5.0.6

### Patch Changes

- [#1725](https://github.com/n1ru4l/envelop/pull/1725)
  [`c1eb2c09`](https://github.com/n1ru4l/envelop/commit/c1eb2c09ac535b076a5c13430c3892d98f7ef957)
  Thanks [@n1ru4l](https://github.com/n1ru4l)! - dependencies updates:

  - Updated dependency [`tslib@^2.5.0` ↗︎](https://www.npmjs.com/package/tslib/v/2.5.0) (from
    `^2.4.0`, in `dependencies`)

- Updated dependencies
  [[`c1eb2c09`](https://github.com/n1ru4l/envelop/commit/c1eb2c09ac535b076a5c13430c3892d98f7ef957)]:
  - @envelop/core@3.0.6
- Updated dependencies
  [[`c1eb2c09`](https://github.com/n1ru4l/envelop/commit/c1eb2c09ac535b076a5c13430c3892d98f7ef957)]:
  - @envelop/extended-validation@2.0.6

## 5.0.5

### Patch Changes

- Updated dependencies
  [[`270249cf`](https://github.com/n1ru4l/envelop/commit/270249cfb7650f8ad64f0167bb45a99475a03b04)]:
  - @envelop/core@3.0.5
- Updated dependencies []:
  - @envelop/extended-validation@2.0.5

## 5.0.4

### Patch Changes

- Updated dependencies []:
  - @envelop/core@3.0.4
- Updated dependencies []:
  - @envelop/extended-validation@2.0.4

## 5.0.3

### Patch Changes

- Updated dependencies
  [[`6b48ef96`](https://github.com/n1ru4l/envelop/commit/6b48ef962020eb7dfd2918626b8a394bff673e4f)]:
  - @envelop/core@3.0.3
- Updated dependencies []:
  - @envelop/extended-validation@2.0.3

## 5.0.2

### Patch Changes

- Updated dependencies
  [[`22f5ccfb`](https://github.com/n1ru4l/envelop/commit/22f5ccfbe69eb052cda6c1908425b63e3d906243)]:
  - @envelop/core@3.0.2
- Updated dependencies []:
  - @envelop/extended-validation@2.0.2

## 5.0.0

### Major Changes

- Updated dependencies
  [[`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f),
  [`dc1e24b5`](https://github.com/n1ru4l/envelop/commit/dc1e24b5340ed7eba300a702b17f9be5cff65a8f)]:
  - @envelop/core@3.0.0

### Patch Changes

- Updated dependencies []:
  - @envelop/extended-validation@2.0.0

## 4.6.0

### Minor Changes

- [#1528](https://github.com/n1ru4l/envelop/pull/1528)
  [`50f214a2`](https://github.com/n1ru4l/envelop/commit/50f214a26cb6595f8ef4dda43cd32dd28d7fc67d)
  Thanks [@{](https://github.com/{)! - give access to execute args in `validateUser` function.

  This is useful in conjunction with the `fieldAuthExtension` parameter to achieve custom per field
  validation:

  ```ts
  import { ValidateUserFn } from '@envelop/generic-auth'

  const validateUser: ValidateUserFn<UserType> = async ({ user, executionArgs, fieldAuthExtension }) => {
    if (!user) {
      throw new Error(`Unauthenticated!`)
    }

    // You have access to the object define in the resolver tree, allowing to define any custom logic you want.
    const validate = fieldAuthExtension?.validate
    if (validate) {
      await validate({ user, variables: executionArgs.variableValues, context: executionArgs.contextValue })
    }
  }

  const resolvers = {
    Query: {

        resolve: (_, { userId }) => getUser(userId),
        extensions: {
          auth: {
            validate: ({ user, variables, context }) => {
              // We can now have access to the operation and variables to decide if the user can execute the query
              if (user.id !== variables.userId) {
                throw new Error(`Unauthorized`)
              }
            }
          }
        }
      }
    }
  }
  ```

## 4.5.0

### Minor Changes

- [#1499](https://github.com/n1ru4l/envelop/pull/1499)
  [`1f7af02b`](https://github.com/n1ru4l/envelop/commit/1f7af02b9f1a16058a6d69fcd48425a93be655c6)
  Thanks [@viniciuspalma](https://github.com/viniciuspalma)! - Adding tslib to package dependencies

  Projects that currently are using yarn Berry with PnP or any strict dependency resolver, that
  requires that all dependencies are specified on package.json otherwise it would endue in an error
  if not treated correct

  Since https://www.typescriptlang.org/tsconfig#importHelpers is currently being used, tslib should
  be exported as a dependency to external runners get the proper import.

  Change on each package:

  ```json
  // package.json
  {
    "dependencies": {
      "tslib": "^2.4.0"
    }
  }
  ```

- Updated dependencies
  [[`1f7af02b`](https://github.com/n1ru4l/envelop/commit/1f7af02b9f1a16058a6d69fcd48425a93be655c6),
  [`ae7bc9a3`](https://github.com/n1ru4l/envelop/commit/ae7bc9a36abd595b0a91f7b4e133017d3eb99a4a)]:
  - @envelop/core@2.6.0

### Patch Changes

- Updated dependencies
  [[`1f7af02b`](https://github.com/n1ru4l/envelop/commit/1f7af02b9f1a16058a6d69fcd48425a93be655c6)]:
  - @envelop/extended-validation@1.9.0

## 4.4.0

### Minor Changes

- Updated dependencies
  [[`5a5f5c04`](https://github.com/n1ru4l/envelop/commit/5a5f5c04177b9e1379fd77db5d6383160879d449),
  [`d828f129`](https://github.com/n1ru4l/envelop/commit/d828f1291254a0f9dfdc3654611087859e4c9708)]:
  - @envelop/core@2.5.0

### Patch Changes

- Updated dependencies []:
  - @envelop/extended-validation@1.8.0

## 4.3.2

### Patch Changes

- 071f946: Fix CommonJS TypeScript resolution with `moduleResolution` `node16` or `nodenext`
- Updated dependencies [071f946]
  - @envelop/core@2.4.2
- Updated dependencies [071f946]
  - @envelop/extended-validation@1.7.2

## 4.3.1

### Patch Changes

- Updated dependencies [787d28a2]
  - @envelop/core@2.4.1
  - @envelop/extended-validation@1.7.1

## 4.3.0

### Minor Changes

- 8bb2738: Support TypeScript module resolution.
- Updated dependencies [8bb2738]
  - @envelop/core@2.4.0

### Patch Changes

- Updated dependencies [8bb2738]
  - @envelop/extended-validation@1.7.0

## 4.2.4

### Patch Changes

- ddd0e4f: `useGenericAuth`'s `ContextType` generic used to accept the types that has an index
  signature which makes it impossible to use it with "fixed types". Now it defaults to
  `DefaultContext` without extending it so any kind of type can be used as `ContextType`.

  Also `useGenericAuth` now takes a third generic which is the name of the field name that contains
  the user data in the context. It can be also inferred from `contextFieldName` of the plugin
  options.

## 4.2.3

### Patch Changes

- fbf6155: update package.json repository links to point to the new home
- Updated dependencies [fbf6155]
  - @envelop/core@2.3.3
- Updated dependencies [fbf6155]
  - @envelop/extended-validation@1.6.3

## 4.2.2

### Patch Changes

- Updated dependencies [07d029b]
  - @envelop/core@2.3.2
  - @envelop/extended-validation@1.6.2

## 4.2.1

### Patch Changes

- Updated dependencies [d5c2c9a]
  - @envelop/core@2.3.1
  - @envelop/extended-validation@1.6.1

## 4.2.0

### Minor Changes

- Updated dependencies [af23408]
  - @envelop/core@2.3.0

### Patch Changes

- @envelop/extended-validation@1.6.0

## 4.1.0

### Minor Changes

- Updated dependencies [ada7fb0]
- Updated dependencies [d5115b4]
- Updated dependencies [d5115b4]
  - @envelop/core@2.2.0

### Patch Changes

- @envelop/extended-validation@1.5.0

## 4.0.1

### Patch Changes

- Updated dependencies [01c8dd6]
  - @envelop/extended-validation@1.4.1

## 4.0.0

### Major Changes

- 7f78839: Use the extended validation phase instead of resolver wrapping for applying
  authentication rules.

  `onResolverCalled` results in wrapping all resolvers in the schema and can be a severe performance
  bottle-neck.

  Now the authorization rules are applied statically before running any execution logic, which
  results in the WHOLE operation being rejected as soon as a field in the selection set does not
  have sufficient permissions.

  The mode `protect-auth-directive` has been renamed to `protect-granular`.

  The `authDirectiveName` option got renamed to `directiveOrExtensionFieldName`.

  Authorization rules for the `protect-all` and `protect-granular`, can be applied via field
  extensions:

  ```typescript
  // schema.ts
  import { GraphQLInt, GraphQLObjectType } from 'graphql'

  const GraphQLQueryType = new GraphQLObjectType({
    name: 'Query',
    fields: {
      foo: {
        type: GraphQLInt,
        resolve: () => 1,
        extensions: {
          skipAuth: true
          // or auth: true for mode "protect-granular".
        }
      }
    }
  })
  ```

  The `validateUser` function is no longer attached to the `context` object passed to the resolvers.
  You can add your own `validateUser` function to the context using `useExtendContext`.

  ```typescript
  const getEnveloped = envelop({
    plugins: [
      useSchema(schema),
      useGenericAuth(options),
      useExtendContext(() => ({ validateUser }))
    ]
  })
  ```

### Minor Changes

- Updated dependencies [78b3db2]
- Updated dependencies [f5eb436]
  - @envelop/core@2.1.0

### Patch Changes

- Updated dependencies [78b3db2]
- Updated dependencies [8030244]
  - @envelop/extended-validation@1.4.0

## 3.0.0

### Patch Changes

- Updated dependencies [4106e08]
- Updated dependencies [aac65ef]
- Updated dependencies [4106e08]
  - @envelop/core@2.0.0

## 2.0.0

### Patch Changes

- Updated dependencies [d9cfb7c]
  - @envelop/core@1.7.0

## 1.2.1

### Patch Changes

- b1a0331: Properly list `@envelop/core` as a `peerDependency` in plugins.

  This resolves issues where the bundled envelop plugins published to npm had logic inlined from the
  `@envelop/core` package, causing `instanceof` check of `EnvelopError` to fail.

- Updated dependencies [b1a0331]
  - @envelop/core@1.6.1

## 1.2.0

### Minor Changes

- 090cae4: GraphQL v16 support

## 1.1.0

### Minor Changes

- 04120de: add support for GraphQL.js 16

### Patch Changes

- 9f63dac: Add `skipAuth` directive to `protect-all` auth option

## 1.0.1

### Patch Changes

- 546db6c: Fix issue with inaccessible directiveNode

## 1.0.1

### Patch Changes

- Fix issue with inaccessible directiveNode

## 1.0.0

### Major Changes

- 40bc444: v1 major release for envelop packages

## 0.2.0

### Minor Changes

- 83b2b92: Extend plugin errors from GraphQLError.

## 0.1.1

### Patch Changes

- 28ad742: Improve TypeScript types

## 0.1.0

### Minor Changes

- eb6f53b: ESM Support for all plugins and envelop core

## 0.0.2

### Patch Changes

- 5fc65a4: Improved type-safety for internal context

## 0.0.1

### Patch Changes

- 55a13bd: NEW PLUGIN!
